<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gimik Perasmian</title>
    
    <!-- React & ReactDOM (Enjin Utama) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (Untuk baca kod JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS (Untuk Design Cantik) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles untuk Animasi -->
    <style>
        body { margin: 0; padding: 0; background-color: #0f172a; color: white; }
        
        @keyframes number-pop {
          0% { transform: scale(0.5); opacity: 0; }
          50% { transform: scale(1.2); opacity: 1; }
          100% { transform: scale(1); opacity: 0; }
        }
        .animate-number-pop {
          animation: number-pop 0.9s ease-out forwards;
        }

        @keyframes confetti {
          0% { transform: translateY(0) rotate(0deg); opacity: 1; }
          100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
        .animate-confetti {
          animation-name: confetti;
          animation-timing-function: linear;
          animation-iteration-count: infinite;
        }

        @keyframes pulse-slow {
          0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(234, 179, 8, 0.5); }
          50% { transform: scale(1.01); box-shadow: 0 0 50px rgba(234, 179, 8, 0.8); }
        }
        .animate-pulse-slow {
          animation: pulse-slow 3s infinite ease-in-out;
        }
        
        @keyframes bounce-slow {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        .animate-bounce-slow {
          animation: bounce-slow 2s infinite ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- IKON KOMPONEN (Ganti lucide-react untuk HTML biasa) ---
        const Icon = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
        const Monitor = (props) => <Icon {...props}><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></Icon>;
        const Maximize = (props) => <Icon {...props}><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Play = (props) => <Icon {...props}><polygon points="6 3 20 12 6 21 6 3"/></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>;

        // --- APLIKASI UTAMA ---
        const App = () => {
            const [image, setImage] = useState(null);
            const [pieces, setPieces] = useState([]);
            const [gridSize, setGridSize] = useState({ rows: 2, cols: 3 });
            const [selectedPiece, setSelectedPiece] = useState(null);
            const [gameStatus, setGameStatus] = useState('setup'); 
            const [count, setCount] = useState(0);
            const [showControls, setShowControls] = useState(true);
            const [title, setTitle] = useState("MAJLIS PERASMIAN");
            const [notification, setNotification] = useState(null);

            const fileInputRef = useRef(null);
            const canvasRef = useRef(null);

            const processImageToPuzzle = (imageUrl) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = imageUrl;
                
                img.onload = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                const maxWidth = 800;
                const scale = Math.min(1, maxWidth / img.width);
                canvas.width = img.width * scale;
                canvas.height = img.height * scale;
                
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                const pieceWidth = canvas.width / gridSize.cols;
                const pieceHeight = canvas.height / gridSize.rows;
                const newPieces = [];

                for (let row = 0; row < gridSize.rows; row++) {
                    for (let col = 0; col < gridSize.cols; col++) {
                    const pieceData = ctx.getImageData(
                        col * pieceWidth, 
                        row * pieceHeight, 
                        pieceWidth, 
                        pieceHeight
                    );
                    
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = pieceWidth;
                    tempCanvas.height = pieceHeight;
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCtx.putImageData(pieceData, 0, 0);

                    newPieces.push({
                        id: row * gridSize.cols + col,
                        currentPos: row * gridSize.cols + col, 
                        src: tempCanvas.toDataURL(), 
                    });
                    }
                }

                const shuffled = [...newPieces].sort(() => Math.random() - 0.5);
                const piecesWithPos = shuffled.map((p, index) => ({
                    ...p,
                    currentPos: index
                }));
                
                setPieces(piecesWithPos);
                setGameStatus('playing');
                };
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                const url = URL.createObjectURL(file);
                setImage(url);
                setGameStatus('setup');
                }
            };

            const startGame = () => {
                if (image) processImageToPuzzle(image);
            };

            const handlePieceClick = (index) => {
                if (gameStatus !== 'playing') return;

                if (selectedPiece === null) {
                setSelectedPiece(index);
                } else {
                const newPieces = [...pieces];
                const pieceA = newPieces[selectedPiece];
                const pieceB = newPieces[index];

                newPieces[selectedPiece] = pieceB;
                newPieces[index] = pieceA;

                setPieces(newPieces);
                setSelectedPiece(null);

                checkWin(newPieces);
                }
            };

            const checkWin = (currentPieces) => {
                const isWin = currentPieces.every((p, index) => p.id === index);
                if (isWin) {
                setTimeout(() => setGameStatus('solved'), 300);
                }
            };

            const startCountdown = () => {
                setGameStatus('counting');
                setCount(1);
                
                const interval = setInterval(() => {
                setCount((prev) => {
                    if (prev >= 5) {
                    clearInterval(interval);
                    setGameStatus('revealed');
                    return 5;
                    }
                    return prev + 1;
                });
                }, 1000); 
            };

            const resetGame = () => {
                setGameStatus('setup');
                setCount(0);
                setSelectedPiece(null);
            };

            const toggleFullScreen = async () => {
                try {
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                } else {
                    if (document.exitFullscreen) await document.exitFullscreen();
                }
                } catch (err) {
                console.log("Fullscreen blocked:", err);
                setNotification("Mod automatik disekat. Sila tekan F11.");
                setTimeout(() => setNotification(null), 4000);
                }
            };

            return (
                <div className="min-h-screen bg-slate-900 text-white font-sans flex flex-col overflow-hidden">
                <canvas ref={canvasRef} className="hidden"></canvas>

                {notification && (
                    <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] bg-red-600 text-white px-6 py-3 rounded-full shadow-xl animate-bounce flex items-center gap-3">
                    <XCircle size={20} />
                    <span className="font-bold text-sm">{notification}</span>
                    </div>
                )}

                {showControls && (
                    <div className="bg-slate-800 p-4 border-b border-slate-700 z-50 shadow-lg">
                    <div className="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-4">
                        <div className="flex items-center gap-2">
                        <Monitor className="text-blue-400" />
                        <h1 className="font-bold">Setup Puzzle</h1>
                        </div>

                        <div className="flex flex-wrap items-center gap-3">
                        <input 
                            type="text" 
                            value={title}
                            onChange={(e) => setTitle(e.target.value)}
                            className="bg-slate-900 border border-slate-600 rounded px-3 py-1 text-sm w-40"
                            placeholder="Tajuk Majlis"
                        />
                        
                        <select 
                            value={gridSize.rows}
                            onChange={(e) => {
                                const val = parseInt(e.target.value);
                                setGridSize(val === 2 ? {rows: 2, cols: 3} : {rows: 3, cols: 3});
                            }}
                            className="bg-slate-900 border border-slate-600 rounded px-3 py-1 text-sm"
                        >
                            <option value={2}>Mudah (6 Keping)</option>
                            <option value={3}>Sederhana (9 Keping)</option>
                        </select>

                        <input 
                            type="file" 
                            accept="image/*" 
                            ref={fileInputRef} 
                            onChange={handleImageUpload} 
                            className="hidden" 
                        />
                        <button 
                            onClick={() => fileInputRef.current.click()}
                            className="bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded text-sm flex items-center gap-2"
                        >
                            <Upload size={14} /> {image ? "Tukar Gambar" : "Upload Gambar"}
                        </button>

                        <button onClick={startGame} disabled={!image} className="bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-sm disabled:opacity-50">
                            Mula Game
                        </button>

                        <button onClick={resetGame} className="bg-yellow-600 hover:bg-yellow-500 px-3 py-1 rounded text-sm">
                            Reset
                        </button>

                        <button onClick={toggleFullScreen} className="bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded text-sm">
                            <Maximize size={14} />
                        </button>

                        <button onClick={() => setShowControls(false)} className="bg-red-600 hover:bg-red-500 px-3 py-1 rounded text-sm font-bold animate-pulse">
                            HIDE MENU
                        </button>
                        </div>
                    </div>
                    </div>
                )}

                <div className="flex-1 relative flex items-center justify-center bg-black p-4">
                    {!showControls && (
                    <div 
                        className="absolute top-0 left-0 w-full h-4 z-50 hover:bg-white/10 cursor-pointer"
                        onClick={() => setShowControls(true)} 
                    />
                    )}

                    {gameStatus === 'setup' && (
                    <div className="text-center text-slate-500">
                        {image ? (
                        <div className="flex flex-col items-center">
                            <img src={image} alt="Preview" className="max-h-[50vh] shadow-xl border-4 border-slate-700 mb-4 opacity-50" />
                            <p className="text-xl text-white mb-4">Gambar sedia. Tekan "Mula Game" di menu untuk pecahkan puzzle.</p>
                            {!showControls && (
                            <button onClick={startGame} className="px-8 py-3 bg-green-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition">
                                MULAKAN PUZZLE SEKARANG
                            </button>
                            )}
                        </div>
                        ) : (
                        <div>
                            <Upload size={64} className="mx-auto mb-4 opacity-30" />
                            <h2 className="text-2xl font-bold mb-2">Sila Upload Gambar Banner</h2>
                            <p>Gunakan menu di bahagian atas.</p>
                        </div>
                        )}
                    </div>
                    )}

                    {(gameStatus === 'playing' || gameStatus === 'solved') && (
                    <div className="flex flex-col items-center w-full max-w-6xl">
                        <h1 className="text-3xl md:text-5xl font-bold text-white mb-8 tracking-wider drop-shadow-lg text-center">
                        {title}
                        </h1>
                        
                        <div 
                        className="grid gap-1 bg-slate-800 p-2 rounded-lg shadow-2xl transition-all duration-500"
                        style={{
                            gridTemplateColumns: `repeat(${gridSize.cols}, 1fr)`,
                            width: '100%',
                            maxWidth: '900px',
                            aspectRatio: `${gridSize.cols}/${gridSize.rows}`
                        }}
                        >
                        {pieces.map((piece, index) => {
                            const isSelected = selectedPiece === index;
                            
                            return (
                            <div
                                key={index}
                                onClick={() => handlePieceClick(index)}
                                className={`
                                relative overflow-hidden cursor-pointer transition-all duration-300
                                ${isSelected ? 'ring-4 ring-yellow-400 z-10 scale-105 shadow-xl' : 'hover:opacity-90'}
                                ${gameStatus === 'solved' ? 'border-none' : 'border border-slate-900'}
                                `}
                            >
                                <img src={piece.src} alt="" className="w-full h-full object-cover block" />
                                
                                {gameStatus === 'playing' && (
                                    <div className={`absolute inset-0 bg-black/0 hover:bg-white/10 transition-colors ${isSelected ? 'bg-yellow-400/20' : ''}`} />
                                )}
                            </div>
                            );
                        })}
                        </div>

                        <p className="mt-6 text-slate-400 animate-pulse">
                        {gameStatus === 'playing' ? "Klik satu petak, kemudian klik petak lain untuk tukar tempat." : "Puzzle Lengkap!"}
                        </p>
                    </div>
                    )}

                    {gameStatus === 'solved' && (
                    <div className="absolute inset-0 z-20 bg-black/60 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-500">
                        <div className="text-center">
                        <CheckCircle size={80} className="text-green-500 mx-auto mb-6 animate-bounce" />
                        <h2 className="text-4xl font-bold mb-8">Puzzle Lengkap!</h2>
                        <button 
                            onClick={startCountdown}
                            className="group relative inline-flex items-center gap-4 px-12 py-6 bg-red-600 hover:bg-red-500 text-white rounded-full text-3xl font-black tracking-widest shadow-[0_0_50px_rgba(220,38,38,0.6)] hover:shadow-[0_0_100px_rgba(220,38,38,1)] transform hover:scale-110 transition-all duration-300 ring-4 ring-offset-4 ring-offset-black ring-red-600"
                        >
                            <Play fill="currentColor" />
                            RASMIKAN
                        </button>
                        </div>
                    </div>
                    )}

                    {gameStatus === 'counting' && (
                    <div className="absolute inset-0 z-30 bg-black flex items-center justify-center">
                        <div className="relative">
                            <div className="absolute inset-0 bg-blue-500 rounded-full animate-ping opacity-20"></div>
                            <h1 
                            key={count} 
                            className="text-[15rem] md:text-[20rem] font-black text-transparent bg-clip-text bg-gradient-to-b from-blue-300 to-blue-700 animate-number-pop drop-shadow-[0_0_30px_rgba(59,130,246,0.8)]"
                            >
                            {count}
                            </h1>
                        </div>
                    </div>
                    )}

                    {gameStatus === 'revealed' && (
                    <div className="absolute inset-0 z-40 bg-black flex flex-col items-center justify-center overflow-hidden animate-in zoom-in duration-1000">
                        {[...Array(50)].map((_, i) => (
                            <div 
                            key={i}
                            className="absolute animate-confetti"
                            style={{
                                left: `${Math.random() * 100}%`,
                                top: `-20%`,
                                backgroundColor: ['#ff0000', '#00ff00', '#0000ff', '#gold', '#magenta'][Math.floor(Math.random() * 5)],
                                width: '15px',
                                height: '30px',
                                animationDuration: `${2 + Math.random() * 2}s`,
                                animationDelay: `${Math.random() * 1}s`
                            }}
                            />
                        ))}

                        <div className="relative p-2 bg-gradient-to-r from-yellow-500 via-yellow-200 to-yellow-500 rounded-xl shadow-2xl animate-pulse-slow">
                            <img src={image} alt="Grand Launch" className="max-h-[85vh] max-w-[95vw] rounded-lg shadow-2xl object-contain" />
                        </div>

                        <h1 className="mt-8 text-5xl md:text-7xl font-black text-white text-center drop-shadow-[0_4px_4px_rgba(0,0,0,1)] tracking-widest animate-bounce-slow">
                            TAHNIAH & SYABAS
                        </h1>
                    </div>
                    )}
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
